{% extends "base.html" %}

{% block title %}Gestión de Proveedores - PACTA{% endblock %}

{% block content %}
    <div class="dashboard-container">
        <!-- Include Sidebar Component -->
        {% include 'components/partials/sidebar.html' %}
        
        <!-- Main Content -->
        <div class="main-content">
            <!-- Content Header -->
            {% set page_title = "Gestión de Proveedores" %}
            {% set page_subtitle = "Administra todos los proveedores del sistema" %}
            {% set page_icon = "fas fa-building" %}
            {% set show_notifications = true %}
            {% set show_user_menu = true %}
            {% include 'components/partials/content_header.html' %}
            
            <!-- Additional Header Actions -->
            <div class="header-actions" style="background: white; padding: 16px 20px; border-radius: 12px; margin-bottom: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); display: flex; gap: 12px; justify-content: flex-end;">
                <button class="btn-primary" onclick="openAddProviderModal()" style="display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-plus"></i>
                    Añadir Proveedor
                </button>
                <button class="btn-icon" title="Actualizar" onclick="location.reload()">
                    <i class="fas fa-sync-alt"></i>
                </button>
                <button class="btn-icon" title="Exportar" onclick="exportProviders()">
                    <i class="fas fa-download"></i>
                </button>
            </div>
            
            <!-- Search and Filter Section -->
            <div class="search-filter-section" style="background: white; padding: 20px; border-radius: 12px; margin-bottom: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                <div style="display: flex; gap: 16px; align-items: center; flex-wrap: wrap;">
                    <div class="search-box" style="flex: 1; min-width: 300px;">
                        <div style="position: relative;">
                            <i class="fas fa-search" style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: #6b7280;"></i>
                            <input type="text" id="searchProviders" placeholder="Buscar proveedores por nombre, categoría o contacto..." style="width: 100%; padding: 12px 12px 12px 40px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px;">
                        </div>
                    </div>
                    <select id="categoryFilter" style="padding: 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px; min-width: 180px;">
                        <option value="">Todas las categorías</option>
                        <option value="tecnologia">Servicios de Tecnología</option>
                        <option value="legal">Consultoría Legal</option>
                        <option value="construccion">Construcción y Obras</option>
                        <option value="financiero">Servicios Financieros</option>
                        <option value="marketing">Marketing y Publicidad</option>
                    </select>
                    <select id="statusFilter" style="padding: 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px; min-width: 120px;">
                        <option value="">Todos los estados</option>
                        <option value="activo">Activo</option>
                        <option value="inactivo">Inactivo</option>
                        <option value="pendiente">Pendiente</option>
                    </select>
                </div>
            </div>
            
            <!-- Providers Statistics Cards -->
            <div class="metrics-grid" style="margin-bottom: 24px;">
                <!-- Total Proveedores -->
                {% set metric_label = "Total Proveedores" %}
                {% set metric_value = estadisticas.total_proveedores if estadisticas and estadisticas.total_proveedores else "24" %}
                {% set metric_icon = "fas fa-building" %}
                {% set metric_color = "#3b82f6" %}
                {% set metric_change = "+3 este mes" %}
                {% set change_type = "positive" %}
                {% include 'components/partials/metric_card.html' %}
                
                <!-- Proveedores Activos -->
                {% set metric_label = "Proveedores Activos" %}
                {% set metric_value = estadisticas.proveedores_activos if estadisticas and estadisticas.proveedores_activos else "21" %}
                {% set metric_icon = "fas fa-check-circle" %}
                {% set metric_color = "#10b981" %}
                {% set metric_change = "87.5% del total" %}
                {% set change_type = "positive" %}
                {% include 'components/partials/metric_card.html' %}
                
                <!-- Contratos Totales -->
                {% set metric_label = "Contratos Totales" %}
                {% set metric_value = estadisticas.contratos_totales if estadisticas and estadisticas.contratos_totales else "156" %}
                {% set metric_icon = "fas fa-file-contract" %}
                {% set metric_color = "#f59e0b" %}
                {% set metric_change = "Con proveedores" %}
                {% set change_type = "positive" %}
                {% include 'components/partials/metric_card.html' %}
                
                <!-- Valor Promedio -->
                {% set metric_label = "Valor Promedio" %}
                {% set metric_value = "$" + "{:,.0f}".format(estadisticas.valor_promedio) if estadisticas and estadisticas.valor_promedio else "$45,200" %}
                {% set metric_icon = "fas fa-dollar-sign" %}
                {% set metric_color = "#8b5cf6" %}
                {% set metric_change = "Por contrato" %}
                {% set change_type = "positive" %}
                {% include 'components/partials/metric_card.html' %}
            </div>
            
            <!-- Tabla Consistente de Proveedores -->
            {% set table_headers = [
                {'key': 'provider_info', 'label': 'Proveedor', 'sortable': true},
                {'key': 'category', 'label': 'Categoría', 'sortable': true},
                {'key': 'contracts', 'label': 'Contratos', 'sortable': true},
                {'key': 'total_value', 'label': 'Valor Total', 'sortable': true},
                {'key': 'status', 'label': 'Estado', 'sortable': true},
                {'key': 'contact', 'label': 'Contacto', 'sortable': false},
                {'key': 'actions', 'label': 'Acciones', 'sortable': false}
            ] %}
            
            {% set table_data = [
                {
                    'provider_info': '<div style="display: flex; align-items: center; gap: 12px;"><div class="provider-avatar" style="width: 40px; height: 40px; background: linear-gradient(135deg, #3b82f6, #1d4ed8); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 14px;">TC</div><div><div style="font-weight: 600; color: #374151;">TechCorp S.A.</div><div style="font-size: 12px; color: #6b7280;">ID: PROV-001</div></div></div>',
                    'category': '<span class="badge" style="background: #dbeafe; color: #1d4ed8; padding: 4px 8px; border-radius: 4px; font-size: 12px;">Servicios de Tecnología</span>',
                    'contracts': '<div style="font-weight: 600; color: #374151;">5</div><div style="font-size: 12px; color: #6b7280;">3 activos</div>',
                    'total_value': '<div style="font-weight: 600; color: #10b981;">$425,000</div>',
                    'status': '<span class="status-badge active" style="background: #d1fae5; color: #065f46; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 600;">Activo</span>',
                    'contact': '<div style="font-size: 13px; color: #374151;">tech@corp.com</div><div style="font-size: 12px; color: #6b7280;">+1 234-567-8900</div>',
                    'actions': '<div style="display: flex; gap: 4px;"><button class="btn-icon-small" title="Ver detalles" onclick="viewProvider(\'PROV-001\');"><i class="fas fa-eye"></i></button><button class="btn-icon-small" title="Editar" onclick="editProvider(\'PROV-001\');"><i class="fas fa-edit"></i></button><button class="btn-icon-small" title="Eliminar" onclick="deleteProvider(\'PROV-001\');"><i class="fas fa-trash"></i></button></div>'
                },
                {
                    'provider_info': '<div style="display: flex; align-items: center; gap: 12px;"><div class="provider-avatar" style="width: 40px; height: 40px; background: linear-gradient(135deg, #10b981, #047857); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 14px;">LS</div><div><div style="font-weight: 600; color: #374151;">Legal Solutions</div><div style="font-size: 12px; color: #6b7280;">ID: PROV-002</div></div></div>',
                    'category': '<span class="badge" style="background: #d1fae5; color: #065f46; padding: 4px 8px; border-radius: 4px; font-size: 12px;">Consultoría Legal</span>',
                    'contracts': '<div style="font-weight: 600; color: #374151;">3</div><div style="font-size: 12px; color: #6b7280;">2 activos</div>',
                    'total_value': '<div style="font-weight: 600; color: #10b981;">$150,000</div>',
                    'status': '<span class="status-badge active" style="background: #d1fae5; color: #065f46; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 600;">Activo</span>',
                    'contact': '<div style="font-size: 13px; color: #374151;">info@legalsol.com</div><div style="font-size: 12px; color: #6b7280;">+1 234-567-8901</div>',
                    'actions': '<div style="display: flex; gap: 4px;"><button class="btn-icon-small" title="Ver detalles" onclick="viewProvider(\'PROV-002\');"><i class="fas fa-eye"></i></button><button class="btn-icon-small" title="Editar" onclick="editProvider(\'PROV-002\');"><i class="fas fa-edit"></i></button><button class="btn-icon-small" title="Eliminar" onclick="deleteProvider(\'PROV-002\');"><i class="fas fa-trash"></i></button></div>'
                },
                {
                    'provider_info': '<div style="display: flex; align-items: center; gap: 12px;"><div class="provider-avatar" style="width: 40px; height: 40px; background: linear-gradient(135deg, #f59e0b, #d97706); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 14px;">CS</div><div><div style="font-weight: 600; color: #374151;">Construction Services</div><div style="font-size: 12px; color: #6b7280;">ID: PROV-003</div></div></div>',
                    'category': '<span class="badge" style="background: #fef3c7; color: #92400e; padding: 4px 8px; border-radius: 4px; font-size: 12px;">Construcción y Obras</span>',
                    'contracts': '<div style="font-weight: 600; color: #374151;">2</div><div style="font-size: 12px; color: #6b7280;">2 activos</div>',
                    'total_value': '<div style="font-weight: 600; color: #10b981;">$320,000</div>',
                    'status': '<span class="status-badge active" style="background: #d1fae5; color: #065f46; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 600;">Activo</span>',
                    'contact': '<div style="font-size: 13px; color: #374151;">contact@construction.com</div><div style="font-size: 12px; color: #6b7280;">+1 234-567-8902</div>',
                    'actions': '<div style="display: flex; gap: 4px;"><button class="btn-icon-small" title="Ver detalles" onclick="viewProvider(\'PROV-003\');"><i class="fas fa-eye"></i></button><button class="btn-icon-small" title="Editar" onclick="editProvider(\'PROV-003\');"><i class="fas fa-edit"></i></button><button class="btn-icon-small" title="Eliminar" onclick="deleteProvider(\'PROV-003\');"><i class="fas fa-trash"></i></button></div>'
                }
            ] %}
            
            {% set empty_message = "No se encontraron proveedores" %}
            
            {% include 'components/partials/consistent_table.html' %}
        </div>
    </div>
    
    <!-- Add Provider Modal -->
    <div class="modal fade" id="addProviderModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-plus" style="color: #3b82f6; margin-right: 8px;"></i>
                        Añadir Nuevo Proveedor
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addProviderForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Nombre de la Empresa *</label>
                                <input type="text" class="form-control" id="providerName" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Categoría *</label>
                                <select class="form-control" id="providerCategory" required>
                                    <option value="">Seleccionar categoría</option>
                                    <option value="tecnologia">Servicios de Tecnología</option>
                                    <option value="legal">Consultoría Legal</option>
                                    <option value="construccion">Construcción y Obras</option>
                                    <option value="financiero">Servicios Financieros</option>
                                    <option value="marketing">Marketing y Publicidad</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Email de Contacto *</label>
                                <input type="email" class="form-control" id="providerEmail" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Teléfono</label>
                                <input type="tel" class="form-control" id="providerPhone">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label class="form-label">Dirección</label>
                                <textarea class="form-control" id="providerAddress" rows="2"></textarea>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Persona de Contacto</label>
                                <input type="text" class="form-control" id="providerContact">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Estado</label>
                                <select class="form-control" id="providerStatus">
                                    <option value="activo">Activo</option>
                                    <option value="inactivo">Inactivo</option>
                                    <option value="pendiente">Pendiente</option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Notas Adicionales</label>
                            <textarea class="form-control" id="providerNotes" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="saveProvider()">Guardar Proveedor</button>
                </div>
            </div>
        </div>
    </div>
    

    
    <script>
        // Provider management functions
        function openAddProviderModal() {
            const modal = new bootstrap.Modal(document.getElementById('addProviderModal'));
            modal.show();
        }
        
        function saveProvider() {
            // Here you would implement the save functionality
            alert('Funcionalidad de guardar proveedor - Implementar con backend');
            bootstrap.Modal.getInstance(document.getElementById('addProviderModal')).hide();
        }
        
        function viewProvider(id) {
            alert('Ver detalles del proveedor: ' + id);
        }
        
        function editProvider(id) {
            alert('Editar proveedor: ' + id);
        }
        
        function deleteProvider(id) {
            if (confirm('¿Está seguro de que desea eliminar este proveedor?')) {
                alert('Eliminar proveedor: ' + id);
            }
        }
        
        function exportProviders() {
            alert('Exportar lista de proveedores - Implementar funcionalidad');
        }
        
        function toggleView(view) {
            // Toggle between table and cards view
            const tableView = document.getElementById('tableView');
            const tableBtn = document.getElementById('tableViewBtn');
            const cardsBtn = document.getElementById('cardsViewBtn');
            
            if (view === 'table') {
                tableView.style.display = 'block';
                tableBtn.classList.add('active');
                cardsBtn.classList.remove('active');
            } else {
                // Cards view implementation would go here
                alert('Vista de tarjetas - Implementar si es necesario');
            }
        }
        
        // Search and filter functionality
        document.getElementById('searchProviders').addEventListener('input', function() {
            // Implement search functionality
            console.log('Searching:', this.value);
        });
        
        document.getElementById('categoryFilter').addEventListener('change', function() {
            // Implement category filter
            console.log('Filter by category:', this.value);
        });
        
        document.getElementById('statusFilter').addEventListener('change', function() {
            // Implement status filter
            console.log('Filter by status:', this.value);
        });
    </script>
{% endblock %}