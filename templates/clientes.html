{% extends "base.html" %}

{% block title %}Gestión de Clientes - PACTA{% endblock %}

{% block content %}
    <div class="dashboard-container">
        <!-- Include Sidebar Component -->
        {% include 'components/partials/sidebar.html' %}
        
        <!-- Main Content -->
        <div class="main-content">
            <!-- Content Header -->
            {% set page_title = "Gestión de Clientes" %}
            {% set page_subtitle = "Administra todos los clientes del sistema" %}
            {% set page_icon = "fas fa-handshake" %}
            {% set show_notifications = false %}
            {% set show_user_menu = false %}
            {% include 'components/partials/content_header.html' %}
            
            <!-- Additional Header Actions -->
            <div class="header-actions" style="margin-top: -60px; margin-bottom: 20px; display: flex; justify-content: flex-end; gap: 8px;">
                <button class="btn-primary" onclick="openAddClientModal()" style="display: flex; align-items: center; gap: 8px; background: #10b981;">
                    <i class="fas fa-plus"></i>
                    Añadir Cliente
                </button>
                <button class="btn-icon" title="Actualizar" onclick="location.reload()">
                    <i class="fas fa-sync-alt"></i>
                </button>
                <button class="btn-icon" title="Exportar" onclick="exportClients()">
                    <i class="fas fa-download"></i>
                </button>
            </div>
            
            <!-- Search and Filter Section -->
            <div class="search-filter-section" style="background: white; padding: 20px; border-radius: 12px; margin-bottom: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                <div style="display: flex; gap: 16px; align-items: center; flex-wrap: wrap;">
                    <div class="search-box" style="flex: 1; min-width: 300px;">
                        <div style="position: relative;">
                            <i class="fas fa-search" style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: #6b7280;"></i>
                            <input type="text" id="searchClients" placeholder="Buscar clientes por nombre, industria o contacto..." style="width: 100%; padding: 12px 12px 12px 40px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px;">
                        </div>
                    </div>
                    <select id="industryFilter" style="padding: 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px; min-width: 180px;">
                        <option value="">Todas las industrias</option>
                        <option value="manufactura">Manufactura Industrial</option>
                        <option value="servicios">Servicios Urbanos</option>
                        <option value="financiero">Servicios Financieros</option>
                        <option value="retail">Retail y Comercio</option>
                        <option value="salud">Salud y Medicina</option>
                        <option value="educacion">Educación</option>
                    </select>
                    <select id="statusFilter" style="padding: 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px; min-width: 120px;">
                        <option value="">Todos los estados</option>
                        <option value="activo">Activo</option>
                        <option value="inactivo">Inactivo</option>
                        <option value="prospecto">Prospecto</option>
                    </select>
                </div>
            </div>
            
            <!-- Clients Statistics Cards -->
            <div class="metrics-grid" style="margin-bottom: 24px;">
                <!-- Total Clientes -->
                {% set metric_label = "Total Clientes" %}
                {% set metric_value = "18" %}
                {% set metric_icon = "fas fa-handshake" %}
                {% set metric_color = "style='color: #10b981;'" %}
                {% set metric_change = "+2 este mes" %}
                {% set change_type = "positive" %}
                {% include 'components/partials/metric_card.html' %}
                
                <!-- Clientes Activos -->
                {% set metric_label = "Clientes Activos" %}
                {% set metric_value = "16" %}
                {% set metric_icon = "fas fa-check-circle" %}
                {% set metric_color = "style='color: #3b82f6;'" %}
                {% set metric_change = "88.9% del total" %}
                {% set change_type = "positive" %}
                {% include 'components/partials/metric_card.html' %}
                
                <!-- Contratos Totales -->
                {% set metric_label = "Contratos Totales" %}
                {% set metric_value = "142" %}
                {% set metric_icon = "fas fa-file-contract" %}
                {% set metric_color = "style='color: #f59e0b;'" %}
                {% set metric_change = "Con clientes" %}
                {% set change_type = "positive" %}
                {% include 'components/partials/metric_card.html' %}
                
                <!-- Valor Promedio -->
                {% set metric_label = "Valor Promedio" %}
                {% set metric_value = "$68,500" %}
                {% set metric_icon = "fas fa-dollar-sign" %}
                {% set metric_color = "style='color: #8b5cf6;'" %}
                {% set metric_change = "Por contrato" %}
                {% set change_type = "positive" %}
                {% include 'components/partials/metric_card.html' %}
            </div>
            
            <!-- Clients Table -->
            {% set table_config = {
                'id': 'clients-table',
                'title': 'Lista de Clientes',
                'api_endpoint': '/api/clients',
                'show_search': true,
                'show_filters': true,
                'show_export': true,
                'show_pagination': true,
                'items_per_page': 10,
                'columns': [
                    {
                        'key': 'client_info',
                        'label': 'Cliente',
                        'sortable': true,
                        'template': 'client_info'
                    },
                    {
                        'key': 'industry',
                        'label': 'Industria',
                        'sortable': true,
                        'template': 'badge'
                    },
                    {
                        'key': 'contracts',
                        'label': 'Contratos',
                        'sortable': true,
                        'template': 'contracts_count'
                    },
                    {
                        'key': 'total_value',
                        'label': 'Valor Total',
                        'sortable': true,
                        'template': 'currency'
                    },
                    {
                        'key': 'status',
                        'label': 'Estado',
                        'sortable': true,
                        'template': 'status_badge'
                    },
                    {
                        'key': 'contact',
                        'label': 'Contacto',
                        'sortable': false,
                        'template': 'contact_info'
                    },
                    {
                        'key': 'actions',
                        'label': 'Acciones',
                        'sortable': false,
                        'template': 'actions'
                    }
                ],
                'filters': [
                    {
                        'key': 'industry',
                        'label': 'Industria',
                        'type': 'select',
                        'options': [
                            {'value': '', 'label': 'Todas las industrias'},
                            {'value': 'manufactura', 'label': 'Manufactura Industrial'},
                            {'value': 'servicios', 'label': 'Servicios Urbanos'},
                            {'value': 'financiero', 'label': 'Servicios Financieros'},
                            {'value': 'retail', 'label': 'Retail y Comercio'},
                            {'value': 'salud', 'label': 'Salud y Medicina'},
                            {'value': 'educacion', 'label': 'Educación'}
                        ]
                    },
                    {
                        'key': 'status',
                        'label': 'Estado',
                        'type': 'select',
                        'options': [
                            {'value': '', 'label': 'Todos los estados'},
                            {'value': 'activo', 'label': 'Activo'},
                            {'value': 'inactivo', 'label': 'Inactivo'},
                            {'value': 'prospecto', 'label': 'Prospecto'}
                        ]
                    }
                ],
                'default_data': [
                    {
                        'id': 'CLI-001',
                        'client_info': {'name': 'Global Industries', 'id': 'CLI-001', 'avatar': 'GI', 'color': '#10b981'},
                        'industry': {'value': 'manufactura', 'label': 'Manufactura Industrial', 'color': '#d1fae5', 'text_color': '#065f46'},
                        'contracts': {'total': 7, 'active': 5},
                        'total_value': 850000,
                        'status': {'value': 'activo', 'label': 'Activo'},
                        'contact': {'email': 'contact@globalind.com', 'phone': '+1 555-123-4567'}
                    },
                    {
                        'id': 'CLI-002',
                        'client_info': {'name': 'Metro Solutions', 'id': 'CLI-002', 'avatar': 'MS', 'color': '#3b82f6'},
                        'industry': {'value': 'servicios', 'label': 'Servicios Urbanos', 'color': '#dbeafe', 'text_color': '#1d4ed8'},
                        'contracts': {'total': 4, 'active': 3},
                        'total_value': 620000,
                        'status': {'value': 'activo', 'label': 'Activo'},
                        'contact': {'email': 'info@metrosol.com', 'phone': '+1 555-234-5678'}
                    },
                    {
                        'id': 'CLI-003',
                        'client_info': {'name': 'Financial Group', 'id': 'CLI-003', 'avatar': 'FG', 'color': '#8b5cf6'},
                        'industry': {'value': 'financiero', 'label': 'Servicios Financieros', 'color': '#ede9fe', 'text_color': '#7c3aed'},
                        'contracts': {'total': 3, 'active': 3},
                        'total_value': 480000,
                        'status': {'value': 'activo', 'label': 'Activo'},
                        'contact': {'email': 'admin@fingroup.com', 'phone': '+1 555-345-6789'}
                    },
                    {
                        'id': 'CLI-004',
                        'client_info': {'name': 'Retail Chain', 'id': 'CLI-004', 'avatar': 'RC', 'color': '#ef4444'},
                        'industry': {'value': 'retail', 'label': 'Retail y Comercio', 'color': '#fee2e2', 'text_color': '#991b1b'},
                        'contracts': {'total': 2, 'active': 1},
                        'total_value': 280000,
                        'status': {'value': 'prospecto', 'label': 'Prospecto'},
                        'contact': {'email': 'sales@retailchain.com', 'phone': '+1 555-456-7890'}
                    }
                ]
            } %}
            {% include 'components/partials/reusable_table.html' %}

        </div>
    </div>
    
    <!-- Add Client Modal -->
    <div class="modal fade" id="addClientModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-plus" style="color: #10b981; margin-right: 8px;"></i>
                        Añadir Nuevo Cliente
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addClientForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Nombre de la Empresa *</label>
                                <input type="text" class="form-control" id="clientName" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Industria *</label>
                                <select class="form-control" id="clientIndustry" required>
                                    <option value="">Seleccionar industria</option>
                                    <option value="manufactura">Manufactura Industrial</option>
                                    <option value="servicios">Servicios Urbanos</option>
                                    <option value="financiero">Servicios Financieros</option>
                                    <option value="retail">Retail y Comercio</option>
                                    <option value="salud">Salud y Medicina</option>
                                    <option value="educacion">Educación</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Email de Contacto *</label>
                                <input type="email" class="form-control" id="clientEmail" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Teléfono</label>
                                <input type="tel" class="form-control" id="clientPhone">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label class="form-label">Dirección</label>
                                <textarea class="form-control" id="clientAddress" rows="2"></textarea>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Persona de Contacto</label>
                                <input type="text" class="form-control" id="clientContact">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Estado</label>
                                <select class="form-control" id="clientStatus">
                                    <option value="activo">Activo</option>
                                    <option value="inactivo">Inactivo</option>
                                    <option value="prospecto">Prospecto</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Tamaño de Empresa</label>
                                <select class="form-control" id="clientSize">
                                    <option value="">Seleccionar tamaño</option>
                                    <option value="pequena">Pequeña (1-50 empleados)</option>
                                    <option value="mediana">Mediana (51-250 empleados)</option>
                                    <option value="grande">Grande (251-1000 empleados)</option>
                                    <option value="corporativo">Corporativo (1000+ empleados)</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Potencial de Negocio</label>
                                <select class="form-control" id="clientPotential">
                                    <option value="">Seleccionar potencial</option>
                                    <option value="bajo">Bajo</option>
                                    <option value="medio">Medio</option>
                                    <option value="alto">Alto</option>
                                    <option value="premium">Premium</option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Notas Adicionales</label>
                            <textarea class="form-control" id="clientNotes" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="saveClient()" style="background: #10b981; border-color: #10b981;">Guardar Cliente</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Reusable Table Component Styles and Scripts -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/components/reusable_table.css') }}">
    <script src="{{ url_for('static', filename='js/reusable_table.js') }}"></script>
    
    <script>
        // Client management functions
        function openAddClientModal() {
            const modal = new bootstrap.Modal(document.getElementById('addClientModal'));
            modal.show();
        }
        
        function saveClient() {
            // Here you would implement the save functionality
            alert('Funcionalidad de guardar cliente - Implementar con backend');
            bootstrap.Modal.getInstance(document.getElementById('addClientModal')).hide();
        }
        
        function viewClient(id) {
            alert('Ver detalles del cliente: ' + id);
        }
        
        function editClient(id) {
            alert('Editar cliente: ' + id);
        }
        
        function deleteClient(id) {
            if (confirm('¿Está seguro de que desea eliminar este cliente?')) {
                alert('Eliminar cliente: ' + id);
            }
        }
        
        function exportClients() {
            alert('Exportar lista de clientes - Implementar funcionalidad');
        }
        
        function toggleView(view) {
            // Toggle between table and cards view
            const tableView = document.getElementById('tableView');
            const tableBtn = document.getElementById('tableViewBtn');
            const cardsBtn = document.getElementById('cardsViewBtn');
            
            if (view === 'table') {
                tableView.style.display = 'block';
                tableBtn.classList.add('active');
                cardsBtn.classList.remove('active');
            } else {
                // Cards view implementation would go here
                alert('Vista de tarjetas - Implementar si es necesario');
            }
        }
        
        // Search and filter functionality
        document.getElementById('searchClients').addEventListener('input', function() {
            // Implement search functionality
            console.log('Searching:', this.value);
        });
        
        document.getElementById('industryFilter').addEventListener('change', function() {
            // Implement industry filter
            console.log('Filter by industry:', this.value);
        });
        
        document.getElementById('statusFilter').addEventListener('change', function() {
            // Implement status filter
            console.log('Filter by status:', this.value);
        });
    </script>
{% endblock %}