<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{{ titulo }}{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-toggle" id="mobileMenuToggle">
        <i class="fas fa-bars"></i>
    </button>
    
    <!-- Mobile Overlay -->
    <div class="mobile-overlay" id="mobileOverlay"></div>
    
    {% block content %}{% endblock %}

    <!-- Include Footer Component -->
    {% include 'components/partials/footer.html' %}

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Mobile Navigation Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const mobileToggle = document.getElementById('mobileMenuToggle');
            const mobileOverlay = document.getElementById('mobileOverlay');
            const sidebar = document.querySelector('.sidebar');
            
            if (mobileToggle && sidebar) {
                // Toggle mobile menu
                mobileToggle.addEventListener('click', function() {
                    sidebar.classList.toggle('mobile-open');
                    mobileOverlay.style.display = sidebar.classList.contains('mobile-open') ? 'block' : 'none';
                    setTimeout(() => {
                        mobileOverlay.classList.toggle('active', sidebar.classList.contains('mobile-open'));
                    }, 10);
                });
                
                // Close menu when clicking overlay
                mobileOverlay.addEventListener('click', function() {
                    sidebar.classList.remove('mobile-open');
                    mobileOverlay.classList.remove('active');
                    setTimeout(() => {
                        mobileOverlay.style.display = 'none';
                    }, 300);
                });
                
                // Close menu when clicking nav links on mobile
                const navLinks = sidebar.querySelectorAll('.nav-link');
                navLinks.forEach(link => {
                    link.addEventListener('click', function() {
                        if (window.innerWidth <= 767) {
                            sidebar.classList.remove('mobile-open');
                            mobileOverlay.classList.remove('active');
                            setTimeout(() => {
                                mobileOverlay.style.display = 'none';
                            }, 300);
                        }
                    });
                });
                
                // Handle window resize
                window.addEventListener('resize', function() {
                    if (window.innerWidth > 767) {
                        sidebar.classList.remove('mobile-open');
                        mobileOverlay.classList.remove('active');
                        mobileOverlay.style.display = 'none';
                    }
                });
            }
            
            // Avatar generation function
            window.generateAvatar = function(name, className = 'user-avatar-small') {
                if (!name) name = 'Usuario';
                
                const words = name.trim().split(' ');
                let initials = '';
                
                if (words.length >= 2) {
                    initials = words[0][0] + words[1][0];
                } else {
                    initials = words[0][0] + (words[0][1] || '');
                }
                
                return `<div class="${className} avatar-generated">${initials.toUpperCase()}</div>`;
            };
            
            window.generateCustomerAvatar = function(name, colorClass = '') {
                if (!name) name = 'Cliente';
                
                const words = name.trim().split(' ');
                let initials = '';
                
                if (words.length >= 2) {
                    initials = words[0][0] + words[1][0];
                } else {
                    initials = words[0][0] + (words[0][1] || '');
                }
                
                const className = `customer-avatar avatar-generated ${colorClass}`.trim();
                return `<div class="${className}">${initials.toUpperCase()}</div>`;
            };
            
            // Replace placeholder images immediately
            function replaceePlaceholderImages() {
                const placeholderImages = document.querySelectorAll('img[src*="via.placeholder.com"]');
                placeholderImages.forEach(img => {
                    const alt = img.alt || 'Usuario';
                    const className = img.className;
                    
                    if (className.includes('customer-avatar')) {
                        // Extract color from original URL if present
                        let colorClass = '';
                        if (img.src.includes('3b82f6')) colorClass = '';
                        else if (img.src.includes('10b981')) colorClass = 'color-green';
                        else if (img.src.includes('f59e0b')) colorClass = 'color-yellow';
                        else if (img.src.includes('ef4444')) colorClass = 'color-red';
                        else if (img.src.includes('8b5cf6')) colorClass = 'color-purple';
                        else if (img.src.includes('ec4899')) colorClass = 'color-pink';
                        
                        img.outerHTML = generateCustomerAvatar(alt, colorClass);
                    } else {
                        img.outerHTML = generateAvatar(alt, className);
                    }
                });
            }
            
            // Replace images on DOM ready and after a short delay
            replaceePlaceholderImages();
            setTimeout(replaceePlaceholderImages, 50);
        });
    </script>
    
    <!-- Funciones de usuario cargadas desde archivo modular -->
    <script src="{{ url_for('static', filename='js/user_functions.js') }}"></script>
    <!-- Funciones del sidebar cargadas desde archivo modular -->
    <script src="{{ url_for('static', filename='js/sidebar_functions.js') }}"></script>
</body>
</html>