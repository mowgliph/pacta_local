{% extends 'base.html' %}

{% block title %}Reportes - PACTA{% endblock %}

{% block content %}
    <div class="dashboard-container">
        <!-- Include Sidebar Component -->
        {% include 'components/partials/sidebar.html' %}
        
        <!-- Main Content -->
        <div class="main-content">
            <!-- Include Header Component with custom content -->
            {% set page_title = 'Reportes' %}
            {% set page_subtitle = 'Generación y análisis de reportes' %}
            {% set page_icon = 'fas fa-chart-bar' %}
            {% set show_notifications = true %}
            {% set show_user_menu = true %}
            {% include 'components/partials/content_header.html' %}
            
            <!-- Metrics Cards -->
            <div class="metrics-grid">
                <!-- Reportes Generados -->
                {% set metric_label = "Reportes Generados" %}
                {% set metric_value = estadisticas.reportes_generados or 89 %}
                {% set metric_icon = "fas fa-file-alt" %}
                {% set metric_color = "text-primary" %}
                {% set metric_change = "+18% vs mes anterior" %}
                {% set change_type = "positive" %}
                {% include 'components/partials/metric_card.html' %}
                
                <!-- Reportes Automáticos -->
                {% set metric_label = "Reportes Automáticos" %}
                {% set metric_value = estadisticas.reportes_automaticos or 34 %}
                {% set metric_icon = "fas fa-robot" %}
                {% set metric_color = "text-success" %}
                {% set metric_change = "+5% vs mes anterior" %}
                {% set change_type = "positive" %}
                {% include 'components/partials/metric_card.html' %}
                
                <!-- Tiempo Promedio -->
                {% set metric_label = "Tiempo Promedio" %}
                {% set metric_value = estadisticas.tiempo_promedio or '2.3h' %}
                {% set metric_icon = "fas fa-stopwatch" %}
                {% set metric_color = "text-warning" %}
                {% set metric_change = "-12% vs mes anterior" %}
                {% set change_type = "negative" %}
                {% include 'components/partials/metric_card.html' %}
                
                <!-- Descargas -->
                {% set metric_label = "Descargas" %}
                {% set metric_value = estadisticas.descargas or 267 %}
                {% set metric_icon = "fas fa-download" %}
                {% set metric_color = "text-purple" %}
                {% set metric_change = "+22% vs mes anterior" %}
                {% set change_type = "positive" %}
                {% include 'components/partials/metric_card.html' %}
            </div>
            
            <!-- Vertical Blocks Layout -->
            <div class="vertical-blocks">
                <!-- Generate Reports Block -->
                <div class="block-section actions-block">
                    <div class="block-header">
                        <h3 class="block-title">Generar Reportes</h3>
                        <p class="block-subtitle">Herramientas para crear reportes personalizados</p>
                    </div>
                    <div class="block-content">
                        <div class="d-flex flex-wrap gap-3">
                            <button class="btn btn-primary flex-fill d-flex align-items-center gap-2" style="min-width: 200px;">
                                <i class="fas fa-chart-line"></i>
                                Reporte Financiero
                            </button>
                            <button class="btn btn-success flex-fill d-flex align-items-center gap-2" style="min-width: 200px;">
                                <i class="fas fa-users"></i>
                                Reporte de Personal
                            </button>
                            <button class="btn btn-warning flex-fill d-flex align-items-center gap-2" style="min-width: 200px;">
                                <i class="fas fa-file-contract"></i>
                                Estado de Contratos
                            </button>
                            <button class="btn btn-purple flex-fill d-flex align-items-center gap-2" style="min-width: 200px;">
                                <i class="fas fa-cog"></i>
                                Reporte Personalizado
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Report Distribution Block -->
                <div class="block-section charts-block">
                    <div class="block-header">
                        <h3 class="block-title">Distribución de Reportes</h3>
                        <p class="block-subtitle">Análisis de tipos y estado de reportes</p>
                    </div>
                    <div class="block-content">
                        <div class="charts-grid">
                            <div class="donut-chart">
                                <canvas id="typeDistChart" width="120" height="120"></canvas>
                                <div class="donut-value">67%</div>
                                <div class="donut-label">Automáticos</div>
                            </div>
                            <div class="donut-chart">
                                <canvas id="statusChart" width="120" height="120"></canvas>
                                <div class="donut-value">94%</div>
                                <div class="donut-label">Completados</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Reports Table Block -->
                <div class="block-section table-block">
                    <div class="block-header">
                        <h3 class="block-title">Reportes Recientes</h3>
                        <p class="block-subtitle">Historial completo de reportes generados</p>
                    </div>
                    <div class="block-content">
                        <!-- Tabla Consistente de Reportes Recientes -->
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h3 class="mb-0">Reportes Recientes</h3>
                            <div>
                                <button class="btn btn-outline-secondary btn-sm me-2" title="Filtrar">
                                    <i class="fas fa-filter"></i>
                                </button>
                                <button class="btn btn-outline-primary btn-sm" title="Exportar">
                                    <i class="fas fa-download"></i>
                                </button>
                            </div>
                        </div>
                        
                        {% set table_headers = [
                            {'title': 'Reporte', 'sortable': true, 'class': ''},
                            {'title': 'Tipo', 'sortable': true, 'class': 'text-center'},
                            {'title': 'Fecha Generación', 'sortable': true, 'class': ''},
                            {'title': 'Tamaño', 'sortable': true, 'class': 'text-center'},
                            {'title': 'Estado', 'sortable': true, 'class': 'text-center'},
                            {'title': 'Descargas', 'sortable': true, 'class': 'text-center'},
                            {'title': 'Acciones', 'sortable': false, 'class': 'text-center'}
                        ] %}
                        
                        {% set table_data = [
                            {
                                'cells': [
                                    {
                                        'value': '<div class="d-flex align-items-center"><i class="fas fa-chart-line text-primary me-2"></i><div><div class="fw-semibold">Análisis Financiero Q1</div><small class="text-muted">Trimestral</small></div></div>',
                                        'class': ''
                                    },
                                    {'type': 'badge', 'value': 'Financiero', 'variant': 'primary', 'class': 'text-center'},
                                    {'value': '28/01/2025', 'class': ''},
                                    {'value': '2.4 MB', 'class': 'text-center'},
                                    {'type': 'badge', 'value': 'Completado', 'variant': 'success', 'class': 'text-center'},
                                    {'value': '<span class="fw-semibold">45</span>', 'class': 'text-center'},
                                    {
                                        'type': 'actions',
                                        'actions': [
                                            {'icon': 'fas fa-download', 'variant': 'outline-primary', 'onclick': 'downloadReport("financiero-q1")', 'tooltip': 'Descargar'},
                                            {'icon': 'fas fa-eye', 'variant': 'outline-secondary', 'onclick': 'viewReport("financiero-q1")', 'tooltip': 'Ver'}
                                        ],
                                        'class': 'text-center'
                                    }
                                ]
                            },
                            {
                                'cells': [
                                    {
                                        'value': '<div class="d-flex align-items-center"><i class="fas fa-users text-success me-2"></i><div><div class="fw-semibold">Reporte de Personal</div><small class="text-muted">Mensual</small></div></div>',
                                        'class': ''
                                    },
                                    {'type': 'badge', 'value': 'RRHH', 'variant': 'success', 'class': 'text-center'},
                                    {'value': '25/01/2025', 'class': ''},
                                    {'value': '1.8 MB', 'class': 'text-center'},
                                    {'type': 'badge', 'value': 'Completado', 'variant': 'success', 'class': 'text-center'},
                                    {'value': '<span class="fw-semibold">23</span>', 'class': 'text-center'},
                                    {
                                        'type': 'actions',
                                        'actions': [
                                            {'icon': 'fas fa-download', 'variant': 'outline-primary', 'onclick': 'downloadReport("personal")', 'tooltip': 'Descargar'},
                                            {'icon': 'fas fa-eye', 'variant': 'outline-secondary', 'onclick': 'viewReport("personal")', 'tooltip': 'Ver'}
                                        ],
                                        'class': 'text-center'
                                    }
                                ]
                            },
                            {
                                'cells': [
                                    {
                                        'value': '<div class="d-flex align-items-center"><i class="fas fa-file-contract text-warning me-2"></i><div><div class="fw-semibold">Estado de Contratos</div><small class="text-muted">Semanal</small></div></div>',
                                        'class': ''
                                    },
                                    {'type': 'badge', 'value': 'Contratos', 'variant': 'warning', 'class': 'text-center'},
                                    {'value': '22/01/2025', 'class': ''},
                                    {'value': '3.1 MB', 'class': 'text-center'},
                                    {'type': 'badge', 'value': 'Procesando', 'variant': 'warning', 'class': 'text-center'},
                                    {'value': '<span class="fw-semibold">12</span>', 'class': 'text-center'},
                                    {
                                        'type': 'actions',
                                        'actions': [
                                            {'icon': 'fas fa-spinner', 'variant': 'outline-warning', 'onclick': 'viewProgress("contratos")', 'tooltip': 'Ver Progreso'},
                                            {'icon': 'fas fa-times', 'variant': 'outline-danger', 'onclick': 'cancelReport("contratos")', 'tooltip': 'Cancelar'}
                                        ],
                                        'class': 'text-center'
                                    }
                                ]
                            },
                            {
                                'cells': [
                                    {
                                        'value': '<div class="d-flex align-items-center"><i class="fas fa-chart-pie" style="color: #8b5cf6;" class="me-2"></i><div><div class="fw-semibold">Reporte Ejecutivo</div><small class="text-muted">Diario</small></div></div>',
                                        'class': ''
                                    },
                                    {'type': 'badge', 'value': 'Ejecutivo', 'variant': 'secondary', 'class': 'text-center'},
                                    {'value': '20/01/2025', 'class': ''},
                                    {'value': '5.2 MB', 'class': 'text-center'},
                                    {'type': 'badge', 'value': 'Completado', 'variant': 'success', 'class': 'text-center'},
                                    {'value': '<span class="fw-semibold">78</span>', 'class': 'text-center'},
                                    {
                                        'type': 'actions',
                                        'actions': [
                                            {'icon': 'fas fa-download', 'variant': 'outline-primary', 'onclick': 'downloadReport("ejecutivo")', 'tooltip': 'Descargar'},
                                            {'icon': 'fas fa-eye', 'variant': 'outline-secondary', 'onclick': 'viewReport("ejecutivo")', 'tooltip': 'Ver'}
                                        ],
                                        'class': 'text-center'
                                    }
                                ]
                            }
                        ] %}
                        
                        {% set empty_message = 'No hay reportes disponibles' %}
                        
                        {% include 'components/partials/consistent_table.html' %}
                    </div>
                    </div>
                </div>

                
                <!-- Report Schedule Block -->
                <div class="block-section activity-block">
                    <div class="block-header">
                        <h3 class="block-title">Programación de Reportes</h3>
                        <p class="block-subtitle">Reportes automáticos programados</p>
                    </div>
                    <div class="block-content">
                        <div style="display: flex; flex-direction: column; gap: 16px;">
                            <div style="display: flex; align-items: center; gap: 12px; padding: 12px; background: #f8fafc; border-radius: 8px;">
                                <div style="width: 8px; height: 8px; background: #3b82f6; border-radius: 50%;"></div>
                                <div style="flex: 1;">
                                    <div style="font-size: 14px; font-weight: 500;">Reporte Financiero</div>
                                    <div style="font-size: 12px; color: #64748b;">Próximo: Mañana 09:00</div>
                                    <div style="font-size: 11px; color: #94a3b8;">Frecuencia: Semanal</div>
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 12px; padding: 12px; background: #f8fafc; border-radius: 8px;">
                                <div style="width: 8px; height: 8px; background: #10b981; border-radius: 50%;"></div>
                                <div style="flex: 1;">
                                    <div style="font-size: 14px; font-weight: 500;">Reporte Ejecutivo</div>
                                    <div style="font-size: 12px; color: #64748b;">Próximo: Hoy 18:00</div>
                                    <div style="font-size: 11px; color: #94a3b8;">Frecuencia: Diario</div>
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 12px; padding: 12px; background: #f8fafc; border-radius: 8px;">
                                <div style="width: 8px; height: 8px; background: #f59e0b; border-radius: 50%;"></div>
                                <div style="flex: 1;">
                                    <div style="font-size: 14px; font-weight: 500;">Reporte de Personal</div>
                                    <div style="font-size: 12px; color: #64748b;">Próximo: 01/02/2025</div>
                                    <div style="font-size: 11px; color: #94a3b8;">Frecuencia: Mensual</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Scripts específicos de reportes -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Funciones de reportes cargadas desde archivo modular -->
    <script src="{{ url_for('static', filename='js/report_functions.js') }}"></script>
    
    <!-- Funciones de notificaciones -->
    <script src="{{ url_for('static', filename='js/notification_functions.js') }}"></script>
    
    <!-- Include Notifications Modal Component -->
    {% include 'components/modals/notificaciones/notifications_modal.html' %}
{% endblock %}