<!-- Reusable Table Component -->
<!-- 
    Usage:
    {% set table_config = {
        'id': 'unique-table-id',
        'title': 'Table Title',
        'subtitle': 'Table description',
        'columns': [
            {'key': 'column1', 'label': 'Column 1', 'sortable': true, 'type': 'text'},
            {'key': 'column2', 'label': 'Column 2', 'sortable': true, 'type': 'currency'},
            {'key': 'column3', 'label': 'Column 3', 'sortable': false, 'type': 'status'},
            {'key': 'actions', 'label': 'Acciones', 'sortable': false, 'type': 'actions'}
        ],
        'data': data_array,
        'show_search': true,
        'show_filters': true,
        'show_export': true,
        'pagination': true,
        'items_per_page': 10,
        'empty_message': 'No hay datos disponibles',
        'empty_icon': 'fas fa-inbox',
        'actions': [
            {'type': 'view', 'icon': 'fas fa-eye', 'title': 'Ver', 'onclick': 'viewItem'},
            {'type': 'edit', 'icon': 'fas fa-edit', 'title': 'Editar', 'onclick': 'editItem'},
            {'type': 'delete', 'icon': 'fas fa-trash', 'title': 'Eliminar', 'onclick': 'deleteItem'}
        ]
    } %}
-->

<div class="block-section table-block">
    <div class="block-header">
        <h3 class="block-title">{{ table_config.title or 'Tabla de Datos' }}</h3>
        <p class="block-subtitle">{{ table_config.subtitle or 'Lista de elementos' }}</p>
    </div>
    <div class="block-content">
        <div class="table-card">
            <!-- Table Header with Controls -->
            <div class="table-header">
                <h3>{{ table_config.title or 'Tabla de Datos' }}</h3>
                <div class="table-controls">
                    {% if table_config.show_search %}
                    <div class="search-container">
                        <input type="text" 
                               class="table-search" 
                               id="search-{{ table_config.id }}" 
                               placeholder="Buscar...">
                        <i class="fas fa-search search-icon"></i>
                    </div>
                    {% endif %}
                    
                    {% if table_config.show_filters %}
                    <button class="btn-icon" 
                            title="Filtrar" 
                            onclick="toggleFilters('{{ table_config.id }}')">
                        <i class="fas fa-filter"></i>
                    </button>
                    {% endif %}
                    
                    {% if table_config.show_export %}
                    <button class="btn-icon" 
                            title="Exportar" 
                            onclick="exportTable('{{ table_config.id }}')">
                        <i class="fas fa-download"></i>
                    </button>
                    {% endif %}
                </div>
            </div>
            
            <!-- Filters Panel (Hidden by default) -->
            {% if table_config.show_filters and table_config.filters %}
            <div class="filters-panel" id="filters-{{ table_config.id }}" style="display: none;">
                <div class="filters-content">
                    {% for filter in table_config.filters %}
                    <div class="filter-group">
                        <label>{{ filter.label }}</label>
                        {% if filter.type == 'select' %}
                        <select class="form-control filter-select" 
                                data-column="{{ filter.column }}" 
                                data-table="{{ table_config.id }}">
                            <option value="">Todos</option>
                            {% for option in filter.options %}
                            <option value="{{ option.value }}">{{ option.label }}</option>
                            {% endfor %}
                        </select>
                        {% elif filter.type == 'date' %}
                        <input type="date" 
                               class="form-control filter-date" 
                               data-column="{{ filter.column }}" 
                               data-table="{{ table_config.id }}">
                        {% endif %}
                    </div>
                    {% endfor %}
                    <button class="btn btn-sm btn-secondary" onclick="clearFilters('{{ table_config.id }}')">Limpiar</button>
                </div>
            </div>
            {% endif %}
            
            <!-- Loading State -->
            <div class="loading-spinner" id="loading-{{ table_config.id }}" style="display: none;">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Cargando...</span>
                </div>
                <p class="mt-2">Cargando datos...</p>
            </div>
            
            <!-- Empty State -->
            <div class="empty-state" id="empty-{{ table_config.id }}" style="display: none;">
                <i class="{{ table_config.empty_icon or 'fas fa-inbox' }}" 
                   style="font-size: 48px; color: #ddd; margin-bottom: 16px;"></i>
                <h4>{{ table_config.empty_message or 'No hay datos disponibles' }}</h4>
                <p>No se encontraron elementos para mostrar.</p>
            </div>
            
            <!-- Table Container -->
            <div class="table-container" id="table-container-{{ table_config.id }}">
                <table class="reusable-table" id="{{ table_config.id }}">
                    <thead>
                        <tr>
                            {% for column in table_config.columns %}
                            <th class="{% if column.sortable %}sortable{% endif %}" 
                                data-column="{{ column.key }}" 
                                data-type="{{ column.type or 'text' }}">
                                {{ column.label }}
                                {% if column.sortable %}
                                <i class="fas fa-sort sort-icon"></i>
                                {% endif %}
                            </th>
                            {% endfor %}
                        </tr>
                    </thead>
                    <tbody>
                        {% if table_config.data and table_config.data|length > 0 %}
                            {% for item in table_config.data %}
                            <tr data-id="{{ item.id or loop.index }}">
                                {% for column in table_config.columns %}
                                <td data-column="{{ column.key }}">
                                    {% if column.template %}
                                        <!-- Custom template processing -->
                                        {% if column.key == 'usuario' %}
                                            <div class="d-flex align-items-center">
                                                <div class="avatar-sm me-3">
                                                    <div class="avatar-title bg-{{ item.avatar_color or 'primary' }} rounded-circle">
                                                        <i class="fas fa-user"></i>
                                                    </div>
                                                </div>
                                                <div>
                                                    <h6 class="mb-0">{{ item.nombre }}</h6>
                                                    <small class="text-muted">{{ item.cargo or 'Sin cargo' }}</small>
                                                </div>
                                            </div>
                                        {% elif column.key == 'rol' %}
                                            <span class="badge bg-{{ 'danger' if item.es_admin else 'primary' }}">
                                                {{ 'Administrador' if item.es_admin else 'Usuario' }}
                                            </span>
                                        {% elif column.key == 'estado' %}
                                            <span class="badge bg-{{ 'success' if item.activo else 'warning' }}">
                                                {{ 'Activo' if item.activo else 'Inactivo' }}
                                            </span>
                                        {% elif column.key == 'acciones' %}
                                             <div class="dropdown">
                                                 <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                                     <i class="fas fa-ellipsis-v"></i>
                                                 </button>
                                                 <ul class="dropdown-menu">
                                                     <li><a class="dropdown-item" href="#" onclick="viewUser({{ item.id }})"><i class="fas fa-eye me-2"></i>Ver Detalles</a></li>
                                                     <li><a class="dropdown-item" href="#" onclick="editUser({{ item.id }})"><i class="fas fa-edit me-2"></i>Editar</a></li>
                                                     <li><hr class="dropdown-divider"></li>
                                                     {% if item.activo %}
                                                         <li><a class="dropdown-item text-warning" href="#" onclick="toggleUserStatus({{ item.id }}, false)"><i class="fas fa-user-slash me-2"></i>Desactivar</a></li>
                                                     {% else %}
                                                         <li><a class="dropdown-item text-success" href="#" onclick="toggleUserStatus({{ item.id }}, true)"><i class="fas fa-user-check me-2"></i>Activar</a></li>
                                                     {% endif %}
                                                 </ul>
                                             </div>
                                         {% elif column.key == 'numero_contrato' %}
                                             <div class="customer-info">
                                                 <i class="fas fa-file-contract" style="color: #3b82f6; margin-right: 8px;"></i>
                                                 <div>
                                                     <div style="font-weight: 500;">{{ item.numero_contrato }}</div>
                                                     <div style="font-size: 12px; color: #64748b;">{{ item.descripcion }}</div>
                                                 </div>
                                             </div>
                                         {% elif column.key == 'cliente' %}
                                             <div class="customer-info">
                                                 <i class="fas fa-building" style="color: #10b981; margin-right: 8px;"></i>
                                                 <div>
                                                     <div style="font-weight: 500;">{{ item.cliente_nombre }}</div>
                                                     <div style="font-size: 12px; color: #64748b;">{{ item.cliente_tipo }}</div>
                                                 </div>
                                             </div>
                                         {% else %}
                                             {{ item[column.key] or '-' }}
                                         {% endif %}
                                    {% elif column.type == 'text' %}
                                        {{ item[column.key] or '-' }}
                                    {% elif column.type == 'currency' %}
                                        <span class="currency-value">
                                            ${{ "{:,.0f}".format(item[column.key]) if item[column.key] else '0' }}
                                        </span>
                                    {% elif column.type == 'status' %}
                                        <span class="status-badge status-{{ item[column.key]|lower }}">
                                            {{ item[column.key]|title if item[column.key] else 'N/A' }}
                                        </span>
                                    {% elif column.type == 'date' %}
                                        {{ item[column.key].strftime('%d/%m/%Y') if item[column.key] else '-' }}
                                    {% elif column.type == 'user_info' %}
                                        <div class="user-info">
                                            <div class="user-avatar">
                                                {% set name_parts = (item[column.key] or 'Usuario').split() %}
                                                {{ name_parts[0][0] }}{{ name_parts[1][0] if name_parts|length > 1 else '' }}
                                            </div>
                                            <div class="user-details">
                                                <div class="user-name">{{ item[column.key] or 'Sin nombre' }}</div>
                                                <div class="user-meta">{{ item[column.meta_key] or '' }}</div>
                                            </div>
                                        </div>
                                    {% elif column.type == 'entity_info' %}
                                        <div class="entity-info">
                                            <i class="{{ column.icon or 'fas fa-circle' }}" style="color: {{ column.color or '#3b82f6' }}; margin-right: 8px;"></i>
                                            <div>
                                                <div class="entity-name">{{ item[column.key] or 'N/A' }}</div>
                                                <div class="entity-meta">{{ item[column.meta_key] or '' }}</div>
                                            </div>
                                        </div>
                                    {% elif column.type == 'actions' %}
                                        <div class="action-buttons">
                                            {% for action in table_config.actions %}
                                                {% if not action.condition or item[action.condition.field] == action.condition.value %}
                                                <button class="btn-icon action-btn" 
                                                        title="{{ action.title }}" 
                                                        onclick="{{ action.onclick }}({{ item.id or loop.index0 }})">
                                                    <i class="{{ action.icon }}"></i>
                                                </button>
                                                {% endif %}
                                            {% endfor %}
                                        </div>
                                    {% else %}
                                        {{ item[column.key] or '-' }}
                                    {% endif %}
                                </td>
                                {% endfor %}
                            </tr>
                            {% endfor %}
                        {% else %}
                            <tr class="empty-row">
                                <td colspan="{{ table_config.columns|length }}" class="text-center text-muted">
                                    {{ table_config.empty_message or 'No hay datos disponibles' }}
                                </td>
                            </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
            
            <!-- Pagination -->
            {% if table_config.pagination and table_config.data and table_config.data|length > (table_config.items_per_page or 10) %}
            <div class="table-pagination" id="pagination-{{ table_config.id }}">
                <div class="pagination-info">
                    <span id="pagination-info-{{ table_config.id }}">Mostrando 1-{{ table_config.items_per_page or 10 }} de {{ table_config.data|length }} elementos</span>
                </div>
                <div class="pagination-controls">
                    <button class="btn btn-sm btn-outline-secondary" 
                            id="prev-{{ table_config.id }}" 
                            onclick="changePage('{{ table_config.id }}', 'prev')">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <div class="page-numbers" id="page-numbers-{{ table_config.id }}">
                        <!-- Page numbers will be generated by JavaScript -->
                    </div>
                    <button class="btn btn-sm btn-outline-secondary" 
                            id="next-{{ table_config.id }}" 
                            onclick="changePage('{{ table_config.id }}', 'next')">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
                <div class="items-per-page">
                    <select class="form-control form-control-sm" 
                            id="items-per-page-{{ table_config.id }}" 
                            onchange="changeItemsPerPage('{{ table_config.id }}', this.value)">
                        <option value="10" {{ 'selected' if (table_config.items_per_page or 10) == 10 }}>10</option>
                        <option value="25" {{ 'selected' if (table_config.items_per_page or 10) == 25 }}>25</option>
                        <option value="50" {{ 'selected' if (table_config.items_per_page or 10) == 50 }}>50</option>
                        <option value="100" {{ 'selected' if (table_config.items_per_page or 10) == 100 }}>100</option>
                    </select>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Initialize table functionality -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        if (typeof initializeReusableTable === 'function') {
            initializeReusableTable('{{ table_config.id }}', {
                itemsPerPage: {{ table_config.items_per_page or 10 }},
                sortable: {{ 'true' if table_config.sortable != false else 'false' }},
                searchable: {{ 'true' if table_config.show_search else 'false' }},
                filterable: {{ 'true' if table_config.show_filters else 'false' }}
            });
        }
    });
</script>